{% comment %}
  Analytics include (production only).

  - Configured via _config.yml:
      analytics:
        google_measurement_id: "G-XXXXXXX"
        honor_dnt: true

  - Can be disabled per-page with front matter:
      no_analytics: true

  Notes:
  - GA measurement IDs are not secrets; safe in a public repo.
  - Depending on your jurisdiction (e.g. EU/EEA), you may need a consent banner
    before loading GA. This include only honors Do Not Track by default.
{% endcomment %}

{% assign ga_id = site.analytics.google_measurement_id | default: site.google_analytics_id %}

{% if jekyll.environment == "production" and ga_id and ga_id != "" and page.no_analytics != true %}
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ ga_id | uri_escape }}"></script>
  <script>
    (function () {
      var honorDnt = {{ site.analytics.honor_dnt | default: true | jsonify }};
      if (honorDnt) {
        var dnt = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
        if (dnt === "1" || dnt === "yes") return;
      }

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "{{ ga_id }}", {
        // These help reduce advertising-related collection.
        "allow_google_signals": false,
        "allow_ad_personalization_signals": false,
        // Harmless if ignored by GA4.
        "anonymize_ip": true
      });
    })();
  </script>
{% endif %}
